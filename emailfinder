(function(){
    // Regular expression to match email addresses
    var regex = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g;
    const results = new Set();

    // Function to process the text and add matches to the results set
    function addMatches(text) {
        var matches = text.matchAll(regex);
        for (const match of matches) {
            results.add(match[0]);
        }
    }

    // Fetch and process scripts
    var scripts = document.getElementsByTagName("script");
    for (var i = 0; i < scripts.length; i++) {
        var src = scripts[i].src;
        if (src) {
            fetch(src)
                .then(response => response.text())
                .then(text => addMatches(text))
                .catch(error => console.log("An error occurred: ", error));
        }
    }

    // Fetch and process links from anchor tags
    var links = document.getElementsByTagName("a");
    for (var i = 0; i < links.length; i++) {
        var href = links[i].href;
        if (href) {
            addMatches(href);
        }
    }

    // Fetch and process the entire page content
    var pageContent = document.documentElement.outerHTML;
    addMatches(pageContent);

    // Write results to the document after 3 seconds
    function writeResults() {
        results.forEach(function(email) {
            document.write(email + "<br>");
        });
    }

    setTimeout(writeResults, 3000);
})();
